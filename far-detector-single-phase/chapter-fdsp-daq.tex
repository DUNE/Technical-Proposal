\chapter{Data Acquisition System}
\label{ch:fdsp-daq}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Data Acquisition System (DAQ) Overview}
\label{sec:fdsp-daq-ov}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Introduction}
\label{sec:fdsp-daq-intro}

The Data Acquisition System provides ...
The system includes (whatever it includes), as shown in Figure.... 

\fixme{Include an image of the overall system, indicating its parts. Show how the system fits into the overall detector.}

The operating principle is illustrated in Figure~\ref{figure-label}... (add figure)

\begin{dunefigure}[optional caption for LoF]{fig:figure-label}
{required full caption (Credit: xyz)}
%\includegraphics[width=0.8\textwidth]{image-filename}
\end{dunefigure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Design Considerations}
\label{sec:fdsp-daq-des-consid}


The Data Acquisition System design must enable... 
...

\fixme{Anne suggests: Within this section add ref to requirements document when it's ready, and maybe list the most important half dozen in a table here). E.g.,}  

\begin{dunetable}
[Important requirements on the DAQ system design]
{p{0.8\textwidth}}
{pdphysicsparams}
{Important requirements on the DAQ system design}   
Requirement  \\ \toprowrule
  \\ \colhline
   \\ \colhline
 ...\\ 
\end{dunetable}

\fixme{By the end of the volume, for every requirement listed in this section, there should exist an explanation of how it will be satisfied.}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Scope}
\label{sec:fdsp-daq-scope}

The scope of the Data Acquisition System includes the continued procurement of materials for, and the fabrication, testing, delivery and installation of the following systems: 

\fixme{Whatever the items are...}

\begin{itemize}
\item Readout electronics 
\item 
\end{itemize}


\newpage 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{DAQ Design}
\label{sec:fdsp-daq-design}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Overview}
\label{sec:fdsp-daq-ltr}

Here we describe the overall readout and data acquistion strategy. This will include the high-level data flow diagram, which is divided in functional boxes, each of which are described in turn in the sections below.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Local Readout \& Buffering}
\label{sec:fdsp-daq-ltr}

Describe how the data is received from the detector electronics, and buffered while awaiting a trigger decision, together with any processing that affects stored data.  The starting point is data incoming from the WIBs and the end point is corresponding data sitting in memory ready for event building. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Local Trigger Primitive Generation}
\label{sec:fdsp-daq-ltr}

In this section we describe generation of basic information that is used in making a trigger decision.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Dataflow}
\label{sec:fdsp-daq-hlt}

Describe the dataflow {\it infrastructure}. This should cover transport of local trigger information, infrastructure for generating local and global triggers, as well as what happens to the data once a trigger is generated (ie. event building). 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Data Selection Algorithms}
\label{sec:fdsp-daq-hlt}

This section describes the strategy for using the trigger/dataflow infrastructure, with example algorithms.

%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{High-Level Trigger}
% \label{sec:fdsp-daq-eb}
%
% Data selection after event building.
%

\subsection{Timing \& Synchronization}
\label{sec:fdsp-daq-hlt}

Describe the generation of timing/synchronisation signals and and distribution to the detectors.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Computing \& Network Infrastructure}
\label{sec:fdsp-daq-infra}

Describes the infrastructure that will support the software components described above.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Run Control \& Monitoring}
\label{sec:fdsp-daq-tcm}

Describe how the system is controlled and monitored.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Interfaces}
\label{sec:fdsp-daq-intfc}

\fixme{Include an image of each interface in appropriate section.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{TPC Electronics}
\label{sec:fdsp-daq-intfc-elec}

Summarise TPC/DAQ interface

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{PD Electronics}
\label{sec:fdsp-daq-intfc-photon}

Summarise photon system/DAQ interface.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Offline Computing}
\label{sec:fdsp-daq-intfc-fnal-cmptg}

Where the data goes after it leaves DAQ.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Slow Control}
\label{sec:fdsp-daq-intfc-ext}

Summarise the interface with slow control.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{External Systems}
\label{sec:fdsp-daq-intfc-ext}

Need to receive information on beam spills, SNEWS.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Production and Assembly}
\label{sec:fdsp-daq-prod-assy}



% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Electronics Production}
% \label{sec:fdsp-daq-?}
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Assembly}
% \label{sec:fdsp-daq-??}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Tooling}
% \label{sec:fdsp-daq-tooling}
%
% \fixme{Don't think we need this one}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Assembly Procedures}
% \label{sec:fdsp-daq-assy}
%
% \fixme{Or this one}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Installation, Integration and Commissioning}
\label{sec:fdsp-daq-install}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Installation}
\label{sec:fdsp-daq-install-transport}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Integration with TPC/PD Electronics}
\label{sec:fdsp-daq-install-transport}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Commissioning}
\label{sec:fdsp-daq-commissioning}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Calibration?}
% \label{sec:fdsp-daq-install-calib}
%
% \fixme{Not needed ?}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Quality Control}
% \label{sec:fdsp-daq-qc}
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Protection and Assembly (Local)}
% \label{sec:fdsp-daq-qc-local}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Post-factory Installation (Remote)}
% \label{sec:fdsp-daq-qc-remote}
%
%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Safety}
\label{sec:fdsp-daq-safety}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% add subsections and labels if needed \subsection{}
%\label{sec:fdsp-daq-safety-}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection{}
%\label{sec:fdsp-daq-safety}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Organization and Management}
\label{sec:fdsp-daq-org}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{DAQ Consortium Organization}
\label{sec:fdsp-daq-org-consortium}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Planning Assumptions}
\label{sec:fdsp-daq-org-assmp}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{WBS and Responsibilities}
\label{sec:fdsp-daq-org-wbs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{High-level Cost and Schedule}
\label{sec:fdsp-daq-org-cs}














